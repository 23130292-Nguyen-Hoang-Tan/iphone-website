{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Apple Shops - Ipad</title>

    <!-- Google font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />

    <!-- Style -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"
    />

    <!-- Isotope filter -->
    <script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.js"></script>

    <style>
      .product-container {
        margin-top: 100px;
        padding: 2rem;
      }

      .page-title {
        font-size: 36px;
        font-weight: 800;
        color: #333;
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      .search-box {
        width: 100%;
        text-align: center;
        margin-bottom: 2rem;
      }

      .search-box input {
        width: 50%;
        padding: 0.8rem 1rem;
        border-radius: 20px;
        border: 1px solid #ccc;
        font-size: 1rem;
        outline: none;
      }

      .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 2rem;
        transition: all 0.3s ease;
      }

      .product-card {
        position: relative;
        background: var(--whiteColor);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: rgba(0, 0, 0, 0.15) 0 4px 12px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .product-card:hover {
        transform: translateY(-5px);
        box-shadow: rgba(0, 0, 0, 0.25) 0 6px 15px;
      }

      .product-image {
        width: 100%;
        height: 200px;
        object-fit: contain;
        object-position: center;
        background-color: #fff;
      }

      .product-detail {
        padding: 1rem;
        text-align: center;
      }

      .product-button {
        width: 80%;
        padding: 0.8rem;
        border: none;
        border-radius: 8px;
        background: var(--primaryColor);
        color: white;
        cursor: pointer;
        transition: background 0.3s;
      }

      .product-button:hover {
        background: var(--fontColor);
      }

      /* HOVER INFO BOX */
      .hover-info {
        position: absolute;
        top: 0;
        left: 0;
        background: rgba(255, 255, 255, 0.95);
        width: 100%;
        height: 100%;
        padding: 1rem;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        font-size: 0.9rem;
        line-height: 1.4rem;
      }

      .product-card:hover .hover-info {
        opacity: 1;
        visibility: visible;
      }

      /* ================== TOAST STYLE ================== */
      .toast {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background-color: #333;
        color: #fff;
        padding: 12px 20px;
        border-radius: 8px;
        font-size: 15px;
        opacity: 0;
        transform: translateY(30px);
        transition: all 0.4s ease;
        z-index: 9999;
      }

      .toast.show {
        opacity: 1;
        transform: translateY(0);
      }
    </style>
  </head>

  <body>
    <!-- Navbar -->
    <nav>
      <h2 class="logo">Apple Shops</h2>

      <div class="menu-list">
        <a href="{% url 'index' %}">Home</a>

        <div class="menu-item">
          <a href="{% url 'category' slug='iphone' %}">Iphone</a>
          <div class="submenu">
            <a href="#">iPhone X Series</a>
            <a href="#">iPhone 11 Series</a>
            <a href="#">iPhone 12 Series</a>
            <a href="#">iPhone 13 Series</a>
            <a href="#">iPhone 14 Series</a>
            <a href="#">iPhone 15 Series</a>
          </div>
        </div>

        <div class="menu-item">
          <a href="{% url 'category' slug='ipad' %}">Ipad</a>
          <div class="submenu">
            <a href="#">iPad Mini</a>
            <a href="#">iPad Air</a>
            <a href="#">iPad Pro</a>
          </div>
        </div>

        <div class="menu-item">
          <a href="{% url 'category' slug='macbook' %}">Macbook</a>
          <div class="submenu">
            <a href="#">MacBook Air</a>
            <a href="#">MacBook Pro 13"</a>
            <a href="#">MacBook Pro 16"</a>
          </div>
        </div>

        <div class="menu-item">
          <a href="{% url 'category' slug='accessory' %}">Accessory</a>
          <div class="submenu">
            <a href="#">·ªêp l∆∞ng</a>
            <a href="#">S·∫°c</a>
            <a href="#">Tai nghe</a>
            <a href="#">Gi√° ƒë·ª°</a>
          </div>
        </div>

        <a href="{% url 'new' %}">News</a>
        <a href="{% url 'contact' %}">Contact</a>
      </div>

      <div class="menu-right">
        <div class="search">
          <button class="btn btn-menu">
            <i class="fas fa-search"></i>
          </button>
        </div>

        <div class="user">
          <button class="btn btn-menu">
            <i class="fas fa-user"></i>
          </button>
        </div>

        <div class="cart">
          <a href="{% url 'cart' %}" class="btn btn-menu">
            <i class="fas fa-shopping-cart"></i>
          </a>
        </div>
      </div>
    </nav>

    <main class="product-container">
      <h2 class="page-title">Ipad</h2>
      <hr />

      <!-- √î t√¨m ki·∫øm -->
      <div class="search-box">
        <input
          type="text"
          id="searchInput"
          placeholder="üîç T√¨m ki·∫øm s·∫£n ph·∫©m..."
        />
      </div>

      <!-- B·ªô l·ªçc s·∫£n ph·∫©m -->
      <div class="filter-bar">
        <select id="filterSeries">
          <option value="*">T·∫•t c·∫£ d√≤ng</option>
          <option value="air">iPad Air</option>
          <option value="pro">iPad Pro</option>
          <option value="mini">iPad Mini</option>
          <option value="gen">iPad Gen</option>
        </select>

        <select id="filterStatus">
          <option value="*">T·∫•t c·∫£</option>
          <option value="new">New</option>
          <option value="bestseller">Best Seller</option>
          <option value="promo">Promo</option>
        </select>

        <select id="filterStorage">
          <option value="*">Dung l∆∞·ª£ng</option>
          <option value="64">64GB</option>
          <option value="128">128GB</option>
          <option value="256">256GB</option>
          <option value="512">512GB</option>
        </select>

        <select id="filterPrice">
          <option value="*">Gi√°</option>
          <option value="2">10 ‚Äì 20 tri·ªáu</option>
          <option value="3">Tr√™n 20 tri·ªáu</option>
        </select>
      </div>

      <div class="product-grid" id="productGrid">
        {% if products %}
          {% for product in products %}
            <div class="product-card" data-price="{{ product.price }}" data-status="{% if product.is_featured %}bestseller{% else %}normal{% endif %}" data-promo="{% if product.old_price %}{{ product.old_price }}{% else %}0{% endif %}" data-series="{{ product.brand|default:''|lower }}" data-storage="{{ product.specs.storage|default:'' }}">
              {% if product.is_featured %}<div class="product-label label-blue">Best Seller</div>{% endif %}
                {% if product.image_url %}
                  <img class="product-image" src="{{ product.image_url }}" alt="{{ product.name }}" />
                {% elif product.main_image %}
                  <img class="product-image" src="{{ product.main_image.url }}" alt="{{ product.name }}" />
                {% else %}
                  <img class="product-image" src="{% static 'images/Ipad/ipad-air-5.avif' %}" alt="{{ product.name }}" />
                {% endif %}
              <div class="product-detail">
                <h4>{{ product.name }}<i class="far fa-heart"></i></h4>
                <div class="rating">
                  <i class="fas fa-star"></i><i class="fas fa-star"></i>
                  <i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i>
                </div>
                <span class="price">{{ product.price|floatformat:0 }} VNƒê</span>
              </div>
              <div class="hover-info">
                <p><strong>T√¨nh tr·∫°ng:</strong> C√≤n {{ product.stock }} s·∫£n ph·∫©m</p>
                {% if product.old_price %}
                  <p><strong>Gi·∫£m gi√°:</strong> {{ product.discount_percent }}%</p>
                {% endif %}
                <p><strong>B·∫£o h√†nh:</strong> 12 th√°ng</p>
                <p><strong>Dung l∆∞·ª£ng:</strong> {{ product.specs.storage|default:'' }} GB</p>
                <p><strong>V·∫≠n chuy·ªÉn:</strong> Mi·ªÖn ph√≠ to√†n qu·ªëc</p>
                <p><strong><a href="{% url 'product_detail_slug' slug=product.slug %}">Xem chi ti·∫øt s·∫£n ph·∫©m</a></strong></p>
              </div>
              <form method="post" action="{% url 'add_to_cart' product.id %}">
                {% csrf_token %}
                <input type="hidden" name="qty" value="1" />
                <button class="product-button" type="submit">Th√™m v√†o gi·ªè</button>
              </form>
            </div>
          {% endfor %}
        {% else %}
          <p>Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o. Vui l√≤ng th√™m s·∫£n ph·∫©m trong trang qu·∫£n tr·ªã.</p>
        {% endif %}
      </div>
    </main>

    <!--footer-->
    <div class="container">
      <footer>
        <link
          rel="stylesheet"
          href="../../src/style/style-component/style-home/footer.css"
        />
        <div class="footer-container">
          <div class="footer-column">
            <h3>S·∫£n Ph·∫©m</h3>
            <ul>
              <li>Iphone</li>
              <li>Ipad</li>
              <li>Macbook</li>
              <li>Ph·ª• ki·ªán</li>
            </ul>
          </div>
          <div class="footer-column">
            <h3>Mua S·∫Øm Tr·ª±c Tuy·∫øn</h3>
            <ul>
              <li>∆Øu ƒê√£i ƒê·ªôc Quy·ªÅn</li>
              <li>Khuy·∫øn m√£i & ∆∞u ƒë√£i</li>
              <li>H∆∞·ªõng d·∫´n ƒë·∫∑t h√†ng</li>
              <li>Ph∆∞∆°ng th·ª©c thanh to√°n</li>
              <li>Ch√≠nh s√°ch giao h√†ng</li>
              <li>Ch√≠nh s√°ch ƒë·ªïi tr·∫£</li>
              <li>Li√™n h·ªá h·ªó tr·ª£</li>
              <li>ƒêi·ªÅu Kho·∫£n & ƒêi·ªÅu Ki·ªán</li>
            </ul>
          </div>
          <div class="footer-column">
            <h3>Ch∆∞∆°ng tr√¨nh ƒë·∫∑c bi·ªát</h3>
            <ul>
              <li>∆Øu ƒë√£i th√†nh vi√™n</li>
              <li>Combo ti·∫øt ki·ªám cho sinh vi√™n</li>
              <li>Ch∆∞∆°ng tr√¨nh qu√† t·∫∑ng</li>
              <li>T√≠ch ƒëi·ªÉm ƒë·ªïi qu√†</li>
            </ul>
          </div>
          <div class="footer-column">
            <h3>B·∫°n C·∫ßn H·ªó Tr·ª£?</h3>
            <ul>
              <li>H·ªèi ƒë√°p th∆∞·ªùng g·∫∑p</li>
              <li>H∆∞·ªõng d·∫´n b·∫£o qu·∫£n s·∫£n ph·∫©m</li>
              <li>Ch√≠nh s√°ch ƒë·∫£m b·∫£o s·∫£n ph·∫©m</li>
              <li>Ch√≠nh s√°ch b·∫£o h√†nh</li>
              <li>G·ª≠i ph·∫£n h·ªìi cho Apple Shop</li>
              <li>Li√™n h·ªá chƒÉm s√≥c kh√°ch h√†ng</li>
            </ul>
          </div>
          <div class="footer-column">
            <h3>S·ª± b·ªÅn v·ªØng</h3>
            <ul>
              <li>M√¥i tr∆∞·ªùng</li>
              <li>B·∫£o m·∫≠t & Quy·ªÅn ri√™ng t∆∞</li>
              <li>Tr·ª£ nƒÉng</li>
              <li>C√¥ng d√¢n Doanh nghi·ªáp</li>
              <li>T√≠nh b·ªÅn v·ªØng c·ªßa Doanh nghi·ªáp</li>
            </ul>
            <h3>Gi·ªõi thi·ªáu v·ªÅ Apple Shop</h3>
            <ul>
              <li>Th√¥ng tin v·ªÅ C√¥ng ty</li>
              <li>Lƒ©nh v·ª±c kinh doanh</li>
              <li>Nh·∫≠n di·ªán th∆∞∆°ng hi·ªáu</li>
              <li>Tuy·ªÉn d·ª•ng</li>
              <li>Tin t·ª©c & chia s·∫ª</li>
              <li>Li√™n h·ªá h·ª£p t√°c</li>
              <li>ƒê·∫°o ƒë·ª©c</li>
              <li>Ch√≠nh s√°ch b·∫£o m·∫≠t</li>
            </ul>
          </div>
        </div>
        <div class="footer-bottom">
          <p>B·∫£n quy·ªÅn ¬© 2018. C√¥ng ty c·ªï ph·∫ßn Th·∫ø Gi·ªõi Di ƒê·ªông.</p>
          <p>C√¥ng ty c·ªï ph·∫ßn Th·∫ø Gi·ªõi Di ƒê·ªông</p>
          <p>Gi·∫•y CNƒêK: 0303217354 do s·ªü KH & ƒêT TP.HCM c·∫•p ng√†y 02/01/2007.</p>
          <p>ƒê·ªãa ch·ªâ: 128 Tr·∫ßn Quang Kh·∫£i, P.T√¢n ƒê·ªãnh, TP.H·ªì Ch√≠ Minh</p>
          <p>ƒêi·ªán tho·∫°i: +84-2839157310</p>
          <p>Email: hotrotmdt@thegioididong.com</p>
        </div>
      </footer>
    </div>

    <!-- Chatbox AI-->
    <div id="chat-widget">
      <!-- Chat Icon -->
      <div id="chat-icon">üí¨</div>

      <!-- Chat Box -->
      <div id="chat-box">
        <div id="chat-header">
          <span>T∆∞ v·∫•n AI</span>
          <button id="close-chat">‚úï</button>
        </div>

        <div id="chat-messages">
          <div class="bot-message">Xin ch√†o! T√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n?</div>
        </div>

        <div id="chat-input-area">
          <input type="text" id="chat-input" placeholder="Nh·∫≠p tin nh·∫Øn..." />
          <button id="send-btn">G·ª≠i</button>
        </div>
      </div>
    </div>

    <script>
      const searchInput = document.getElementById("searchInput");
      const productGrid = document.getElementById("productGrid");
      const products = Array.from(productGrid.children);

      searchInput.addEventListener("input", () => {
        const query = searchInput.value.toLowerCase();

        // T√°ch s·∫£n ph·∫©m kh·ªõp v√† kh√¥ng kh·ªõp
        const matched = [];
        const unmatched = [];

        products.forEach((card) => {
          const name = card
            .querySelector(".product-detail h4")
            .innerText.toLowerCase();

          if (name.includes(query)) {
            matched.push(card);
          } else {
            unmatched.push(card);
          }
        });

        // X√≥a to√†n b·ªô grid v√† s·∫Øp l·∫°i th·ª© t·ª±
        productGrid.innerHTML = "";

        // Hi·ªán s·∫£n ph·∫©m kh·ªõp, ·∫©n s·∫£n ph·∫©m kh√¥ng kh·ªõp
        matched.forEach((card) => {
          card.style.display = "block";
          productGrid.appendChild(card);
        });
        unmatched.forEach((card) => {
          card.style.display = "none";
          productGrid.appendChild(card);
        });
      });

      document.addEventListener("DOMContentLoaded", function () {
        // ================== Y√äU TH√çCH + ADD TO CART ==================
        document.addEventListener("click", function (e) {
          if (e.target.classList.contains("fa-heart")) {
            e.target.classList.toggle("liked");
            showToast("‚ù§Ô∏è ƒê√£ th√™m v√†o danh s√°ch y√™u th√≠ch!");
          }

          if (e.target.classList.contains("product-button")) {
            showToast("üõí S·∫£n ph·∫©m ƒë√£ ƒë∆∞·ª£c th√™m v√†o gi·ªè h√†ng!");
          }
        });

        // ======== H√ÄM HI·ªÇN TH·ªä TOAST ========
        function showToast(message) {
          const toast = document.createElement("div");
          toast.className = "toast";
          toast.innerText = message;
          document.body.appendChild(toast);

          // Hi·ªán ra v·ªõi animation
          setTimeout(() => {
            toast.classList.add("show");
          }, 100);

          // T·ª± ƒë·ªông ·∫©n sau 2.5 gi√¢y
          setTimeout(() => {
            toast.classList.remove("show");
            setTimeout(() => toast.remove(), 500);
          }, 2500);
        }
      });
    </script>

    <script>
      // Isotope Filter Script
      var iso = new Isotope("#productGrid", {
        itemSelector: ".product-card",
        layoutMode: "fitRows",
        transitionDuration: 0,
      });

      function applyFilter() {
        let series = document.getElementById("filterSeries").value;
        let status = document.getElementById("filterStatus").value;
        let storage = document.getElementById("filterStorage").value;
        let price = document.getElementById("filterPrice").value;

        iso.arrange({
          filter: function (item) {
            let pSeries = item.getAttribute("data-series");
            let pStatus = item.getAttribute("data-status");
            let pStorage = item.getAttribute("data-storage");
            let pPrice = parseInt(item.getAttribute("data-price"));

            // Filter theo series
            if (series !== "*" && pSeries !== series) return false;

            // Filter theo tr·∫°ng th√°i (new, bestseller, promo)
            if (status !== "*" && pStatus !== status) return false;

            // Filter storage
            if (storage !== "*" && pStorage !== storage) return false;

            // Filter gi√°:
            if (price === "1" && pPrice > 10000000) return false;
            if (price === "2" && (pPrice < 10000000 || pPrice > 20000000))
              return false;
            if (price === "3" && pPrice < 20000000) return false;

            return true;
          },
        });
      }

      // G·ªçi l·∫°i filter khi thay ƒë·ªïi
      document.querySelectorAll(".filter-bar select").forEach((sel) => {
        sel.addEventListener("change", applyFilter);
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const chatIcon = document.getElementById("chat-icon");
        const chatBox = document.getElementById("chat-box");
        const closeChat = document.getElementById("close-chat");
        const sendBtn = document.getElementById("send-btn");
        const chatInput = document.getElementById("chat-input");
        const chatMessages = document.getElementById("chat-messages");

        if (!chatIcon || !chatBox || !closeChat) {
          console.error("Chatbox HTML kh√¥ng t·ªìn t·∫°i!");
          return;
        }

        chatIcon.onclick = () => {
          chatBox.classList.add("open");
          chatIcon.style.display = "none";
        };

        closeChat.onclick = () => {
          chatBox.classList.remove("open");
          chatIcon.style.display = "flex";
        };

        // G·ª≠i tin nh·∫Øn
        sendBtn.onclick = sendMessage;
        chatInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter") sendMessage();
        });

        function sendMessage() {
          const text = chatInput.value.trim();
          if (!text) return;

          // Tin nh·∫Øn user
          const userMsg = document.createElement("div");
          userMsg.classList.add("user-message");
          userMsg.textContent = text;
          chatMessages.appendChild(userMsg);

          chatInput.value = "";
          chatMessages.scrollTop = chatMessages.scrollHeight;

          // Bot tr·∫£ l·ªùi t·∫°m
          setTimeout(() => {
            const botMsg = document.createElement("div");
            botMsg.classList.add("bot-message");
            botMsg.textContent = "AI s·∫Ω tr·∫£ l·ªùi ·ªü ƒë√¢y...";
            chatMessages.appendChild(botMsg);
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }, 600);
        }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@12/swiper-bundle.min.js"></script>
    <script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.js"></script>
    <script src="{% static 'js/app.js' %}"></script>
  </body>
</html>

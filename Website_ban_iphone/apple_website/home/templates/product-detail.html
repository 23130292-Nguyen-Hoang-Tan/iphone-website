{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Apple Shops - {{ product.name }}</title>

    <!-- Google font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />

    <!-- Style -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <style>
      /* ====================== PRODUCT DETAIL ====================== */
      .product-detail-page {
        padding-top: 120px;
        width: 100%;
        font-family: Arial, sans-serif;
      }

      /* Layout */
      .detail-container {
        max-width: 1200px;
        margin: auto;
        display: flex;
        gap: 40px;
        padding: 20px;
      }

      .detail-image img {
        border: 7px inset #f8dbd2ff;
        padding: 14px;
        border-radius: 14px;
        background: #fff;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        transform: translateX(-25px);
      }

      .detail-image img {
        width: 350px;
        border-radius: 10px;
      }

      .detail-info h2 {
        font-size: 36px;
        margin-bottom: 16px;
        font-weight: 800;
        line-height: 1.2;
      }

      /* Rating */
      .rating i {
        color: #f5b100;
        margin-right: 3px;
      }

      .review-count {
        margin-left: 6px;
        color: #666;
      }

      /* Price n·ªïi b·∫≠t */
      .price {
        font-size: 32px; /* tƒÉng size */
        font-weight: 900;
        color: #e60023;
        margin: 12px 0 25px;
      }

      /* Promo box ƒë·∫πp h∆°n */
      .promo-box {
        background: #ffe9e9;
        padding: 18px;
        border-radius: 10px;
        margin: 18px 0;
        border-left: 4px solid #e60023;
      }

      .promo-box h4 {
        margin-bottom: 8px;
        font-size: 18px;
      }

      /* Options */
      .option-box h4 {
        margin: 15px 0 8px;
        font-size: 18px;
        font-weight: 600;
      }

      .option-list .option {
        padding: 10px 18px;
        border: 1px solid #bbb;
        background: #fff;
        margin-right: 10px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 15px;
      }

      .option.active {
        border-color: #e60023;
        color: #e60023;
        font-weight: bold;
      }

      .color-list {
        display: flex;
        gap: 12px;
      }

      .color {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        cursor: pointer;
        border: 3px solid transparent;
        box-sizing: border-box;
      }

      /* M·ªói m√†u ph·∫£i c√≥ background */
      .color-gold {
        background: gold;
      }

      .color-silver {
        background: #d9d9d9;
      }

      .color-black {
        background: #000;
      }

      .color.active {
        border-color: #e60023;
      }

      .spec-section {
        margin-top: 60px;
      }

      .spec-section h2 {
        font-size: 30px;
        margin-bottom: 20px;
        font-weight: 700;
      }

      .spec-table {
        width: 100%;
        border-collapse: collapse;
        border: 1px solid #ccc;
        background: #fafafa;
        border-radius: 8px;
        overflow: hidden;
      }

      .spec-table td {
        padding: 14px 18px;
        border-bottom: 1px solid #ddd;
        font-size: 17px;
      }

      .spec-table tr td:first-child {
        font-weight: bold;
        width: 30%;
        background: #f0f0f0;
      }

      /* Description ƒë·∫πp h∆°n */
      .description-section {
        margin-top: 50px;
        background: #f9f9f9;
        padding: 25px 30px;
        border-radius: 12px;
        line-height: 1.8;
        font-size: 18px;
        border-left: 4px solid #e60023;
      }

      .description-section h2 {
        font-size: 30px;
        margin-bottom: 15px;
        font-weight: 700;
      }

      /* ==================== PRODUCT GRID ==================== */
      .page-title {
        margin-top: 40px;
        font-size: 28px;
        font-weight: 700;
      }

      .product-grid {
        margin-top: 30px;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 25px;
        max-width: 1200px;
        margin: 30px auto;
      }

      /* Wrap t·ªïng */
      .related-container {
        margin-top: 50px;
        padding: 20px;
        position: relative;
        background: #ffffff;
        border-radius: 12px;
        box-shadow: 0 4px 18px rgba(0, 0, 0, 0.13);
      }

      .related-container .page-title {
        margin-bottom: 20px;
        font-size: 24px;
        font-weight: 700;
      }

      /* Slider */
      .related-slider {
        display: flex;
        gap: 20px;
        overflow-x: auto;
        scroll-behavior: smooth;
        padding-bottom: 10px;
      }

      .related-slider::-webkit-scrollbar {
        display: none; /* ·∫©n scroll */
      }

      /* Product item */
      .related-item {
        min-width: 180px;
        text-decoration: none;
      }

      .product-card.small-card {
        text-align: center;
        padding: 12px;
      }

      .product-card.small-card .view-detail {
        margin-top: 6px;
        font-size: 15px;
        color: #0b0000f0;
        font-weight: 500;
        text-decoration: underline;
        transition: 0.3s;
      }

      .product-card.small-card .view-detail:hover {
        color: #e50505f0;
      }

      .small-card {
        border-radius: 12px;
        background: #fff;
        padding: 12px;
        box-shadow: 0 3px 12px rgba(0, 0, 0, 0.12);
        text-align: center;
        transition: 0.25s;
      }

      .small-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.18);
      }

      .small-card img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 10px;
      }

      .small-card h4 {
        margin: 10px 0 5px;
        font-size: 16px;
        color: #222;
      }

      .small-card .price {
        font-size: 15px;
        font-weight: 600;
        color: #e60023;
      }

      /* Button tr√°i/ph·∫£i */
      .slide-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: white;
        border: none;
        width: 42px;
        height: 42px;
        border-radius: 50%;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        cursor: pointer;
        z-index: 10;
        font-size: 18px;
        transition: 0.2s;
      }

      .slide-btn:hover {
        background: #f3f3f3;
      }

      .left-btn {
        left: -10px;
      }

      .right-btn {
        right: -10px;
      }
    </style>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"
    />
  </head>

  <body>
    <!-- Navbar -->
    <nav>
      <h2 class="logo">Apple Shops</h2>

      <div class="menu-list">
        <a href="{% url 'index' %}">Home</a>

        <div class="menu-item">
          <a href="{% url 'category' slug='iphone' %}">Iphone</a>
          <div class="submenu">
            <a href="#">iPhone X Series</a>
            <a href="#">iPhone 11 Series</a>
            <a href="#">iPhone 12 Series</a>
            <a href="#">iPhone 13 Series</a>
            <a href="#">iPhone 14 Series</a>
            <a href="#">iPhone 15 Series</a>
          </div>
        </div>

        <div class="menu-item">
          <a href="{% url 'category' slug='ipad' %}">Ipad</a>
          <div class="submenu">
            <a href="#">iPad Mini</a>
            <a href="#">iPad Air</a>
            <a href="#">iPad Pro</a>
          </div>
        </div>

        <div class="menu-item">
          <a href="{% url 'category' slug='macbook' %}">Macbook</a>
          <div class="submenu">
            <a href="#">MacBook Air</a>
            <a href="#">MacBook Pro 13"</a>
            <a href="#">MacBook Pro 16"</a>
          </div>
        </div>

        <div class="menu-item">
          <a href="{% url 'category' slug='accessory' %}">Accessory</a>
          <div class="submenu">
            <a href="#">·ªêp l∆∞ng</a>
            <a href="#">S·∫°c</a>
            <a href="#">Tai nghe</a>
            <a href="#">Gi√° ƒë·ª°</a>
          </div>
        </div>

        <a href="{% url 'new' %}">News</a>
        <a href="{% url 'contact' %}">Contact</a>
      </div>

      <div class="menu-right">
        <div class="search">
          <button class="btn btn-menu">
            <i class="fas fa-search"></i>
          </button>
        </div>

        <div class="user">
          <button class="btn btn-menu">
            <i class="fas fa-user"></i>
          </button>
        </div>

        <div class="cart">
          <a href="{% url 'cart' %}" class="btn btn-menu">
            <i class="fas fa-shopping-cart"></i>
          </a>
        </div>
      </div>
    </nav>

    <!-- ===================== PRODUCT DETAIL ===================== -->
    <main class="product-detail-page">
      <div class="detail-container">
        <!-- Left: Image -->
        <div class="detail-image">
          {% if product.image_url %}
            <img src="{{ product.image_url }}" alt="{{ product.name }}" />
          {% elif product.main_image %}
            <img src="{{ product.main_image.url }}" alt="{{ product.name }}" />
          {% else %}
            <img src="{% static 'images/Iphone/iphone_11_pro_max.avif' %}" alt="{{ product.name }}" />
          {% endif %}
          {% if product.images.all %}
          <div class="gallery">
            {% for img in product.images.all %}
            <img src="{{ img.image.url }}" alt="{{ img.caption }}" style="width:80px;height:80px;object-fit:cover;margin:6px;border-radius:8px;" />
            {% endfor %}
          </div>
          {% endif %}
        </div>

        <!-- Right: Info -->
        <div class="detail-info">
          <h2>{{ product.name }}</h2>

          <div class="rating">
            <!-- optional rating placeholder -->
            <span class="review-count">&nbsp;</span>
          </div>

          <h3 class="price">{{ product.price|floatformat:0 }} VNƒê</h3>

          <!-- Status -->
          <p><strong>T√¨nh tr·∫°ng kho:</strong> C√≤n {{ product.stock }} s·∫£n ph·∫©m</p>
          <p><strong>B·∫£o h√†nh:</strong> 12 th√°ng ch√≠nh h√£ng</p>
          <p><strong>V·∫≠n chuy·ªÉn:</strong> Mi·ªÖn ph√≠ to√†n qu·ªëc</p>

          <!-- Promotion -->
          <div class="promo-box">
            <h4>üéÅ Khuy·∫øn m√£i</h4>
            <ul>
              <li>∆Øu ƒë√£i d√†nh cho s·∫£n ph·∫©m n√†y</li>
            </ul>
          </div>

          <!-- Variants (storage) -->
          <div class="option-box">
            <h4>Phi√™n b·∫£n (Dung l∆∞·ª£ng):</h4>
            <div class="option-list">
              <select id="variantSelect" name="variant_id" form="addToCartForm">
                <option value="0">Ch·ªçn phi√™n b·∫£n</option>
                {% for v in variants %}
                  <option value="{{ v.id }}" data-price="{{ v.price }}" {% if default_variant and v.id == default_variant.id %}selected{% endif %}>{{ v.name }} ‚Äî {{ v.price|floatformat:0 }} VNƒê</option>
                {% endfor %}
              </select>
            </div>
          </div>

          <form id="addToCartForm" method="post" action="{% url 'add_to_cart' product.id %}">
            {% csrf_token %}
            <input type="hidden" name="qty" value="1" />
            <input type="hidden" name="variant_id" id="variant_id_input" value="{% if default_variant %}{{ default_variant.id }}{% else %}0{% endif %}" />
            <button class="product-button add-to-cart" type="submit">Th√™m v√†o gi·ªè h√†ng</button>
          </form>

          <script>
            // update hidden variant_id and displayed price when user changes variant
            (function(){
              const select = document.getElementById('variantSelect');
              const hidden = document.getElementById('variant_id_input');
              const priceEl = document.querySelector('.price');
              if(!select) return;
              select.addEventListener('change', function(){
                const opt = select.options[select.selectedIndex];
                hidden.value = opt.value || 0;
                const p = opt.dataset.price;
                if(p && priceEl) priceEl.textContent = parseFloat(p).toFixed(0) + ' VNƒê';
              });
            })();
          </script>
        </div>
      </div>

      <!-- Product Specification -->
      <div class="spec-section">
        <h2>Th√¥ng s·ªë k·ªπ thu·∫≠t</h2>
        <table class="spec-table">
          {% if product.specs %}
          {% for key, val in product.specs.items %}
          <tr>
            <td>{{ key }}</td>
            <td>{{ val }}</td>
          </tr>
          {% endfor %}
          {% else %}
          <tr>
            <td colspan="2">Th√¥ng s·ªë ƒëang c·∫≠p nh·∫≠t.</td>
          </tr>
          {% endif %}
        </table>
      </div>

      <!-- Description -->
      <div class="description-section">
        <h2>M√¥ t·∫£ s·∫£n ph·∫©m</h2>
        <p>
          iPhone 11 Pro Max s·ªü h·ªØu thi·∫øt k·∫ø cao c·∫•p, hi·ªáu nƒÉng m·∫°nh m·∫Ω nh·ªù chip
          A13 Bionic c√πng c·ª•m 3 camera chuy√™n nghi·ªáp mang l·∫°i kh·∫£ nƒÉng ch·ª•p ·∫£nh
          v√† quay video c·ª±c k·ª≥ ·∫•n t∆∞·ª£ng. M√†n h√¨nh OLED 6.5 inch cho ƒë·ªô s√°ng v√†
          ƒë·ªô t∆∞∆°ng ph·∫£n tuy·ªát v·ªùi.
        </p>
      </div>

      <hr />

      <!-- ===================== RELATED PRODUCTS ===================== -->
      <div class="related-container">
        <h2 class="page-title">S·∫£n ph·∫©m ƒë·ªÅ xu·∫•t</h2>
        <hr />

        <!-- Buttons -->
        <button class="slide-btn left-btn">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button class="slide-btn right-btn">
          <i class="fas fa-chevron-right"></i>
        </button>

        <!-- Slider Wrapper -->
        <div class="related-slider">
          <!-- PRODUCT 1 -->
          <a href="product-detail-1.html" class="related-item">
            <div class="product-card small-card">
              <img src="{% static 'images/Iphone/Iphone13.avif' %}" alt="" />
              <h4>iPhone 13</h4>
              <span class="price">12.990.000 VNƒê</span>
              <p class="view-detail">Xem chi ti·∫øt</p>
            </div>
          </a>

          <!-- PRODUCT 2 -->
          <a href="product-detail-2.html" class="related-item">
            <div class="product-card small-card">
              <img src="{% static 'images/Ipad/ipad10.jpg' %}" alt="" />
              <h4>iPad 10</h4>
              <span class="price">25.990.000 VNƒê</span>
              <p class="view-detail">Xem chi ti·∫øt</p>
            </div>
          </a>

          <!-- PRODUCT 3 -->
          <a href="product-detail-3.html" class="related-item">
            <div class="product-card small-card">
              <img
                src="{% static 'images/Macbook/macbook-pro-16.jpeg' %}"
                alt=""
              />
              <h4>Macbook Pro 16</h4>
              <span class="price">34.590.000 VNƒê</span>
              <p class="view-detail">Xem chi ti·∫øt</p>
            </div>
          </a>

          <!-- PRODUCT 4 -->
          <a href="product-detail-4.html" class="related-item">
            <div class="product-card small-card">
              <img src="{% static 'images/phu_kien/tai-nghe.jpg' %}" alt="" />
              <h4>Airpods Pro</h4>
              <span class="price">3.900.000 VNƒê</span>
              <p class="view-detail">Xem chi ti·∫øt</p>
            </div>
          </a>
        </div>
      </div>
    </main>

    <!-- ===================== FOOTER ===================== -->
    <div class="container">
      <footer>
        <link
          rel="stylesheet"
          href="../../src/style/style-component/style-home/footer.css"
        />
        <div class="footer-container">
          <div class="footer-column">
            <h3>S·∫£n Ph·∫©m</h3>
            <ul>
              <li>Iphone</li>
              <li>Ipad</li>
              <li>Macbook</li>
              <li>Ph·ª• ki·ªán</li>
            </ul>
          </div>

          <div class="footer-column">
            <h3>Mua S·∫Øm Tr·ª±c Tuy·∫øn</h3>
            <ul>
              <li>∆Øu ƒê√£i ƒê·ªôc Quy·ªÅn</li>
              <li>Khuy·∫øn m√£i & ∆∞u ƒë√£i</li>
              <li>H∆∞·ªõng d·∫´n ƒë·∫∑t h√†ng</li>
              <li>Ph∆∞∆°ng th·ª©c thanh to√°n</li>
              <li>Ch√≠nh s√°ch giao h√†ng</li>
              <li>Ch√≠nh s√°ch ƒë·ªïi tr·∫£</li>
              <li>Li√™n h·ªá h·ªó tr·ª£</li>
              <li>ƒêi·ªÅu Kho·∫£n & ƒêi·ªÅu Ki·ªán</li>
            </ul>
          </div>

          <div class="footer-column">
            <h3>Ch∆∞∆°ng tr√¨nh ƒë·∫∑c bi·ªát</h3>
            <ul>
              <li>∆Øu ƒë√£i th√†nh vi√™n</li>
              <li>Combo ti·∫øt ki·ªám cho sinh vi√™n</li>
              <li>Ch∆∞∆°ng tr√¨nh qu√† t·∫∑ng</li>
              <li>T√≠ch ƒëi·ªÉm ƒë·ªïi qu√†</li>
            </ul>
          </div>

          <div class="footer-column">
            <h3>B·∫°n C·∫ßn H·ªó Tr·ª£?</h3>
            <ul>
              <li>H·ªèi ƒë√°p th∆∞·ªùng g·∫∑p</li>
              <li>H∆∞·ªõng d·∫´n b·∫£o qu·∫£n s·∫£n ph·∫©m</li>
              <li>Ch√≠nh s√°ch ƒë·∫£m b·∫£o s·∫£n ph·∫©m</li>
              <li>Ch√≠nh s√°ch b·∫£o h√†nh</li>
              <li>G·ª≠i ph·∫£n h·ªìi cho Apple Shop</li>
              <li>Li√™n h·ªá chƒÉm s√≥c kh√°ch h√†ng</li>
            </ul>
          </div>

          <div class="footer-column">
            <h3>S·ª± b·ªÅn v·ªØng</h3>
            <ul>
              <li>M√¥i tr∆∞·ªùng</li>
              <li>B·∫£o m·∫≠t & Quy·ªÅn ri√™ng t∆∞</li>
              <li>Tr·ª£ nƒÉng</li>
              <li>C√¥ng d√¢n Doanh nghi·ªáp</li>
              <li>T√≠nh b·ªÅn v·ªØng c·ªßa Doanh nghi·ªáp</li>
            </ul>

            <h3>Gi·ªõi thi·ªáu v·ªÅ Apple Shop</h3>
            <ul>
              <li>Th√¥ng tin v·ªÅ C√¥ng ty</li>
              <li>Lƒ©nh v·ª±c kinh doanh</li>
              <li>Nh·∫≠n di·ªán th∆∞∆°ng hi·ªáu</li>
              <li>Tuy·ªÉn d·ª•ng</li>
              <li>Tin t·ª©c & chia s·∫ª</li>
              <li>Li√™n h·ªá h·ª£p t√°c</li>
              <li>ƒê·∫°o ƒë·ª©c</li>
              <li>Ch√≠nh s√°ch b·∫£o m·∫≠t</li>
            </ul>
          </div>
        </div>

        <div class="footer-bottom">
          <p>B·∫£n quy·ªÅn ¬© 2018. C√¥ng ty c·ªï ph·∫ßn Th·∫ø Gi·ªõi Di ƒê·ªông.</p>
          <p>C√¥ng ty c·ªï ph·∫ßn Th·∫ø Gi·ªõi Di ƒê·ªông</p>
          <p>Gi·∫•y CNƒêK: 0303217354 do s·ªü KH & ƒêT TP.HCM c·∫•p ng√†y 02/01/2007.</p>
          <p>ƒê·ªãa ch·ªâ: 128 Tr·∫ßn Quang Kh·∫£i, P.T√¢n ƒê·ªãnh, TP.H·ªì Ch√≠ Minh</p>
          <p>ƒêi·ªán tho·∫°i: +84-2839157310</p>
          <p>Email: hotrotmdt@thegioididong.com</p>
        </div>
      </footer>
    </div>

    <!-- Chatbox AI-->
    <div id="chat-widget">
      <!-- Chat Icon -->
      <div id="chat-icon">üí¨</div>

      <!-- Chat Box -->
      <div id="chat-box">
        <div id="chat-header">
          <span>T∆∞ v·∫•n AI</span>
          <button id="close-chat">‚úï</button>
        </div>

        <div id="chat-messages">
          <div class="bot-message">Xin ch√†o! T√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n?</div>
        </div>

        <div id="chat-input-area">
          <input type="text" id="chat-input" placeholder="Nh·∫≠p tin nh·∫Øn..." />
          <button id="send-btn">G·ª≠i</button>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const chatIcon = document.getElementById("chat-icon");
        const chatBox = document.getElementById("chat-box");
        const closeChat = document.getElementById("close-chat");
        const sendBtn = document.getElementById("send-btn");
        const chatInput = document.getElementById("chat-input");
        const chatMessages = document.getElementById("chat-messages");

        if (!chatIcon || !chatBox || !closeChat) {
          console.error("Chatbox HTML kh√¥ng t·ªìn t·∫°i!");
          return;
        }

        chatIcon.onclick = () => {
          chatBox.classList.add("open");
          chatIcon.style.display = "none";
        };

        closeChat.onclick = () => {
          chatBox.classList.remove("open");
          chatIcon.style.display = "flex";
        };

        // G·ª≠i tin nh·∫Øn
        sendBtn.onclick = sendMessage;
        chatInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter") sendMessage();
        });

        function sendMessage() {
          const text = chatInput.value.trim();
          if (!text) return;

          // Tin nh·∫Øn user
          const userMsg = document.createElement("div");
          userMsg.classList.add("user-message");
          userMsg.textContent = text;
          chatMessages.appendChild(userMsg);

          chatInput.value = "";
          chatMessages.scrollTop = chatMessages.scrollHeight;

          // Bot tr·∫£ l·ªùi t·∫°m
          setTimeout(() => {
            const botMsg = document.createElement("div");
            botMsg.classList.add("bot-message");
            botMsg.textContent = "AI s·∫Ω tr·∫£ l·ªùi ·ªü ƒë√¢y...";
            chatMessages.appendChild(botMsg);
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }, 600);
        }
      });
    </script>

    <script>
      const slider = document.querySelector(".related-slider");
      const left = document.querySelector(".left-btn");
      const right = document.querySelector(".right-btn");

      right.onclick = () => (slider.scrollLeft += 260);
      left.onclick = () => (slider.scrollLeft -= 260);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/swiper@12/swiper-bundle.min.js"></script>
    <script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.js"></script>
    <script src="{% static 'js/app.js' %}"></script>
  </body>
</html>
